# 并发

## CopyOnWriteArrayList

线程安全的`list`,写时复制策略(修改操作都是在底层的一个复制数组)

- 源码分析

```java
public boolean add(E e) {
    final ReentrantLock lock = this.lock;
    //独占锁
    lock.lock();
    try {
        Object[] elements = getArray();
        int len = elements.length;
        //copy源数组并长度+1
        Object[] newElements = Arrays.copyOf(elements, len + 1);
        newElements[len] = e;
        //设置源数组
        setArray(newElements);
        return true;
    } finally {
        //释放独占锁
        lock.unlock();
    }
}
```

- 弱一致性
  - 返回迭代器后,其他线程的操作不影响该线程

>> 无界list
